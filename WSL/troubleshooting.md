---
title: Troubleshooting the Windows Susbystem for Linux
description: Provides detailed information about common errors and issues people run into while running Linux on the Windows Susbystem for Linux. 
keywords: BashOnWindows, bash, wsl, windows, windowssubsystem, ubuntu
author: scooley
ms.author: scooley
ms.date: 11/15/2017
ms.topic: article
ms.prod: windows-subsystem-for-linux
ms.service: windows-subsystem-for-linux
ms.assetid: 6753f1b2-200e-49cc-93a5-4323e1117246
---

# Troubleshooting

### Bash loses network connectivity once connected to a VPN

If after connecting to a VPN on Windows, bash loses network connectivity, try this workaround from within bash. This workaround will allow you to manually override the DNS resolution through `/etc/resolv.conf`.

1. Take a note of the DNS server of the VPN from doing `ipconfig.exe /all`
2. Make a copy of the existing resolv.conf
   `sudo cp /etc/resolv.conf /etc/resolv.conf.new`
3. Unlink the current resolv.con
   `sudo unlink /etc/resolv.conf`
4. `sudo mv /etc/resolv.conf.new /etc/resolv.conf`
5. Open `/etc/resolv.conf` and <br/>
   a. Delete the first line from the file, which says "\# This file was automatically generated by WSL. To stop automatic generation of this file, remove this line.". <br/>
   b. Add the DNS entry from (1) above as the very first entry in the list of DNS servers. <br/>
   c. Close the file. <br/>

Once you have disconnected the VPN, you will have to revert the changes to `/etc/resolv.conf`. To do this, do:
1. `cd /etc`
2. `sudo mv resolv.conf resolv.conf.new`
3. `sudo ln -s ../run/resolvconf/resolv.conf resolv.conf`

### Starting bash gives an error code
1. Download these two .txt files and rename them .cmd
  https://github.com/Microsoft/BashOnWindows/files/288621/start_lxcore_trace.txt <br/>
  https://github.com/Microsoft/BashOnWindows/files/288622/stop_lxcore_trace.txt
2. Run start_lxcore_trace.cmd from an admin command prompt
3. Launch bash.exe (repro the scenario).
4. Run stop_lxcore_trace.cmd from an admin command prompt
6. You should now see three .etl files in the directory you ran the script from.
7. Post the files with your GitHub post to our [issue page](https://github.com/Microsoft/BashOnWindows/issues). 

### Updating Bash on Ubuntu on Windows

There are two components of Bash on Ubuntu on Windows that can require updating. 

1. The Windows Subsystem for Linux
  
   Upgrading this portion of Bash on Ubuntu on Windows will enable any new fixes outlines in the [release notes](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes). Ensure that you are subscribed to the Windows Insider Program and that your build is up to date. For finer grain control including resetting your Ubuntu instance check out the [command reference page](https://msdn.microsoft.com/en-us/commandline/wsl/reference).

2. The Ubuntu user binaries 

   Upgrading this portion of Bash on Ubuntu on Windows will install any updates to the Ubuntu user binaries including applications that you have installed via apt-get. To update run the following commands in Bash:
  
   1. `apt-get update`
   2. `apt-get upgrade`
  
### Apt-get upgrade errors
Some packages use features that we haven't implemented yet. `udev`, for example, isn't supported yet and causes several `apt-get upgrade` errors.

To fix issues related to `udev`, follow the following steps:

1. Write the following to `/usr/sbin/policy-rc.d` and save your changes.
  
   ``` BASH
   #!/bin/sh
   exit 101
   ```
  
2. Add execute permissions to `/usr/sbin/policy-rc.d`
   ``` BASH
   chmod +x /usr/sbin/policy-rc.d
   ```
  
3. Run the following commands
   ``` BASH
   dpkg-divert --local --rename --add /sbin/initctl
   ln -s /bin/true /sbin/initctl
   ```
  
### "Error: 0x80040306" on installation
This has to do with the fact that we do not support legacy console.
To turn off legacy console:

1. Open cmd.exe
1. Right click title bar -> Properties -> Uncheck Use legacy console
1. Click OK

### "Error: 0x80040154" after Windows update
The Windows Subsystem for Linux feature may be disabled during a Windows update. If this happens the Windows feature must be re-enabled. Instructions for enabling the Windows Subsystem for Linux can be found in the [Installation Guide](https://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-guihttps://msdn.microsoft.com/en-us/commandline/wsl/install_guide#enable-the-windows-subsystem-for-linux-feature-gui).

### Changing the display language
WSL install will try to automatically change the Ubuntu locale to match the locale of your Windows install.  If you do not want this behavior you can run this command to change the Ubuntu locale after install completes.  You will have to relaunch bash.exe for this change to take effect.

The below example changes to locale to en-US:
``` BASH
sudo update-locale LANG=en_US.UTF8
```

### Installation issues after Windows system restore
1.	Delete the `%windir%\System32\Tasks\Microsoft\Windows\Windows Subsystem for Linux` folder. <br/>
  **Note: Do not do this if your optional feature is fully installed and working.**
2.	Enable the WSL optional feature (if not already)
3.	Reboot
4.	lxrun /uninstall /full
5.	Install bash

### No internet access in WSL
Some users have reported issues with specific firewall applications blocking internet access in WSL.  The firewalls reported are:

1. Kaspersky
1. AVG
1. Avast

In some cases turning off the firewall allows for access.  In some cases simply having the firewall installed looks to block access.

### Permission Denied error when using ping
#### [Anniversary Update](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes#build-14388-to-windows-10-anniversary-update) 

Administrator privileges in Windows are required to run ping in WSL.  To run ping, run Bash on Ubuntu on Windows as an administrator, or run bash.exe from a CMD/PowerShell prompt with administrator privileges.

#### [Build 14926+](https://msdn.microsoft.com/en-us/commandline/wsl/release_notes#build-14926)
  Administrator privileges no longer required.

### Bash is hung
If while working with bash, you find that bash is hung (or deadlocked) and not responding to inputs, help us diagnose the issue by collecting and reporting a memory dump. Note that these steps will crash your system. Do not do this if you are not comfortable with that or save your work prior to doing this.  <br/>
To collect a memory dump:
1. Change the memory dump type to "complete memory dump". While changing the dump type, take a note of your current type.
2. Use the [steps](https://blogs.technet.microsoft.com/askpfeplat/2015/04/05/how-to-force-a-diagnostic-memory-dump-when-a-computer-hangs/) to configure crash using keyboard control.
3. Repro the hang or deadlock.
4. Crash the system using the key sequence from (2).
5. The system will crash and collect the memory dump.
6. Once the system reboots, report the memory.dmp to secure@microsoft.com. The default location of the dump file is %SystemRoot%\memory.dmp or C:\Windows\memory.dmp if C: is the system drive. In the email, note that the dump is for the WSL or Bash on Windows team.
7. Restore the memory dump type to the original setting.

### Check your build number

To find your PC's architecture and Windows build number, open  
**Settings** > **System** > **About**

Look for the **OS Build** and **System Type** fields.  
    ![](media/system.png) 


To find your Windows Server build number, run the following in PowerShell:  
``` PowerShell
systeminfo | Select-String "^OS Name","^OS Version"
```

### Confirm WSL is enabled
You can confirm that the Windows Subsystem for Linux is enabled by running the following in PowerShell:  
``` PowerShell
PowerShell
Get-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
```

### OpenSSH-Server connection issues
Trying to connect your SSH server is failed with the following error: "Connection closed by 127.0.0.1 port 22".
1. Make sure your OpenSSH Server is running:
   ``` BASH
   sudo service ssh status
   ```
   and you've followed this tutorial:
   https://help.ubuntu.com/lts/serverguide/openssh-server.html.en
2. Stop the sshd service and start sshd in debug mode:
   ``` BASH
   sudo service ssh stop
   sudo /usr/sbin/sshd -d
   ```
3. Check the startup logs and make sure HostKeys are available and you don't see log messages such as:
   debug1: sshd version OpenSSH_7.2, OpenSSL 1.0.2g  1 Mar 2016
   debug1: key_load_private: incorrect passphrase supplied to decrypt private key
   debug1: key_load_public: No such file or directory
   Could not load host key: /etc/ssh/ssh_host_rsa_key
   debug1: key_load_private: No such file or directory
   debug1: key_load_public: No such file or directory
   Could not load host key: /etc/ssh/ssh_host_dsa_key
   debug1: key_load_private: No such file or directory
   debug1: key_load_public: No such file or directory
   Could not load host key: /etc/ssh/ssh_host_ecdsa_key
   debug1: key_load_private: No such file or directory
   debug1: key_load_public: No such file or directory
   Could not load host key: /etc/ssh/ssh_host_ed25519_key

If you do see such messages and the keys are missing under `/etc/ssh/`, you will have to regenerate the keys or just purge&install openssh-server:
```BASH
sudo apt-get purge openssh-server
sudo apt-get install openssh-server
```

